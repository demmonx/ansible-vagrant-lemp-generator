#!/usr/bin/env bash

# Variable definitions
. .env

# Sub-modules calls
install() {
    shift
    lemp-manager-install $@
}

installMulti() {
    shift
    lemp-manger-install-multiple $@
}

update() {
    shift
    lemp-manager-update $@
}

delete() {
    shift
    lemp-manager-delete $@
}

hosts() {
    shift
    lemp-manager-hosts-update $@
}

run() {
    shift
    # TODO check param and loop over it
    vboxmanage startvm $@ --type headless
}

halt() {
    shift
    # TODO check param and loop over it
    vboxmanage controlvm $@ poweroff
}

usage() {
    shift
    echo "lemp-manager deploy --name=... --ip=... [--cpu=nb --ram=nb (mb)]"
    echo "lemp-manager deploy-multiple <file>"
    echo "lemp-manager update"
    echo "lemp-manager remove --name=..."
    echo "lemp-manager start <name>"
    echo "lemp-manager halt <name>"
    echo "lemp-manager help"
    echo "\$ lemp-manager update-hosts"
}

# Check if they are at least 1 param
if [[ $# -eq 0 ]]; then # Error, no args provided
    usage
    exit 1
fi

# Filter the first arg
case $1 in
    deploy)
        install "$@"
        ;;
    deploy-multiple)
        installMulti "$@"
        ;;
    update)
        update "$@"
        ;;
    remove)
        delete "$@"
        ;;
    update-hosts)
        hosts "$@"
        ;;
    help)
        usage
         ;;
    start)
        run "$@"
         ;;
    halt)
        halt "$@"
         ;;
    *)
        echo "ERROR: unknown parameter \"$1\""
        usage
        exit 1
        ;;
esac
