#!/usr/bin/env bash

install() {
    shift
    bin/install.sh $@
}

installMulti() {
    shift
    bin/install-multiple.sh $@
}

update() {
    shift
    bin/update.sh $@
}

delete() {
    shift
    bin/delete.sh $@
}

hosts() {
    shift
    bin/hosts-update.sh $@
}

run() {
    shift
    vboxmanage startvm $@ --type headless
}

halt() {
    shift
    vboxmanage controlvm $@ acpipowerbutton
}

usage() {
    shift
    echo "Create a VM : deploy add --name=... --ip=... [--cpu=nb --ram=nb (mb)]"
    echo "Update all the VMs : deploy update"
    echo "Delete a VM : deploy remove --name=..."
    echo "Help : deploy help"
}

# Check if they are at least 1 param
if [[ $# -eq 0 ]]; then # Error, no args provided
    usage
    exit 1
fi

# Filter the first arg
case $1 in
    add)
        install "$@"
        ;;
    multiple-add)
        installMulti "$@"
        ;;
    update)
        update "$@"
        ;;
    remove)
        delete "$@"
        ;;
    update-hosts)
        hosts "$@"
        ;;
    help)
        usage
         ;;
    run)
        run
         ;;
    halt)
        halt
         ;;
    *)
        echo "ERROR: unknown parameter \"$PARAM\""
        usage
        exit 1
        ;;
esac
